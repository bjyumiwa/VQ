<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>WHO VQ — Start</title>

  <!-- 背景画像を先読み（パスは public/items/bg/*.jpg で統一） -->
  <link rel="preload" as="image" href="public/items/bg/sunrise.jpg" />
  <link rel="preload" as="image" href="public/items/bg/beach_day.jpg" />
  <link rel="preload" as="image" href="public/items/bg/night_beach.jpg" />

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP","Hiragino Kaku Gothic ProN","Hiragino Sans","Yu Gothic", Meiryo, sans-serif;
      color:#fff; background:#000; overflow:hidden;
    }
    .bg{
      position:fixed; inset:0; background-size:cover; background-position:center;
      opacity:0; transition:opacity .8s ease; z-index:-1;
    }
    .bg.show{opacity:1}

    #topbar{
      position:fixed; left:0; right:0; top:0; display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:10px 14px; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0));
      z-index:10;
    }
    #langWrap{display:flex; align-items:center; gap:8px}
    #lang{appearance:none; padding:6px 10px; border-radius:10px; border:none; background:rgba(0,0,0,.5); color:#fff}

    #phaseBadge{
      padding:6px 10px; border-radius:999px; background:rgba(0,0,0,.45); backdrop-filter: blur(4px);
      border:1px solid rgba(255,255,255,.25); font-size:12px;
    }

    #center{
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px;
      text-align:center; padding:16px;
      background: radial-gradient(ellipse at center, rgba(0,0,0,.0), rgba(0,0,0,.25) 60%, rgba(0,0,0,.55));
    }
    h1{font-size:clamp(26px, 4.2vw, 48px); text-shadow:0 2px 8px rgba(0,0,0,.6)}
    p.lead{opacity:.95}

    .btns{display:flex; flex-direction:column; gap:12px; width:min(90vw, 420px); margin-top:6px}
    button, .btn{
      width:100%; padding:14px 16px; border:none; border-radius:14px;
      background:rgba(255,255,255,.1); color:#fff; font-size:16px; cursor:pointer;
      backdrop-filter: blur(4px);
      border:1px solid rgba(255,255,255,.25);
      transition: transform .06s ease, background .2s ease;
    }
    button:hover,.btn:hover{background:rgba(255,255,255,.18)}
    button:active,.btn:active{transform:scale(.99)}
    button[disabled]{opacity:.5; cursor:not-allowed}

    #resumeNote{font-size:12px; opacity:.85}
    #foot{
      position:fixed; left:0; right:0; bottom:8px; text-align:center; font-size:12px; opacity:.8
    }
    /* 画面読み上げ/キーボード利用向けフォーカス */
    :focus-visible{outline:2px solid #fff; outline-offset:2px}
  </style>
</head>
<body>
  <div id="bg" class="bg" aria-hidden="true"></div>

  <div id="topbar" role="banner">
    <div id="langWrap">
      <label for="lang" id="langLabel">Language</label>
      <select id="lang" aria-label="language">
        <option value="ja">日本語</option>
        <option value="en">English</option>
        <option value="zh">中文</option>
        <option value="ko">한국어</option>
      </select>
    </div>
    <div id="phaseBadge" aria-live="polite"></div>
  </div>

  <main id="center">
    <h1 id="title">WHO VQ</h1>
    <p class="lead" id="subtitle"></p>

    <div class="btns" role="group" aria-label="main actions">
      <button id="btnStart"></button>
      <button id="btnResume"></button>
      <button id="btnAbout"></button>
    </div>
    <div id="resumeNote"></div>
  </main>

  <div id="foot">© WHO VQ Project</div>

  <script>
    /***** 設定・定数 *****/
    const BG_MAP = {
      sunrise: "public/items/bg/sunrise.jpg",
      day:     "public/items/bg/beach_day.jpg",
      night:   "public/items/bg/night_beach.jpg",
    };

    const I18N = {
      ja: {
        htmlLang: "ja",
        title: "WHO VQ",
        subtitle: "海辺からはじまる、あなたとAIの小さな物語",
        start: "スタート",
        resume: "続きから",
        about: "研究について",
        noResume: "前回の続きはありません。",
        resumeTo: (p)=> `前回は「${p}」まで進みました。`,
        phase: { sunrise:"朝日", day:"昼", night:"夜" },
        langLabel: "言語",
      },
      en: {
        htmlLang: "en",
        title: "WHO VQ",
        subtitle: "A small story of you and AI, starting by the sea",
        start: "Start",
        resume: "Continue",
        about: "About the Research",
        noResume: "No previous progress found.",
        resumeTo: (p)=> `Last time you reached “${p}”.`,
        phase: { sunrise:"Sunrise", day:"Day", night:"Night" },
        langLabel: "Language",
      },
      zh: {
        htmlLang: "zh",
        title: "WHO VQ",
        subtitle: "与你与AI的海边小故事，从此开始",
        start: "开始",
        resume: "继续",
        about: "关于研究",
        noResume: "未找到上次进度。",
        resumeTo: (p)=> `上次进行到 “${p}”。`,
        phase: { sunrise:"日出", day:"白天", night:"夜晚" },
        langLabel: "语言",
      },
      ko: {
        htmlLang: "ko",
        title: "WHO VQ",
        subtitle: "바닷가에서 시작하는 당신과 AI의 작은 이야기",
        start: "시작",
        resume: "이어하기",
        about: "연구 소개",
        noResume: "이전 진행 기록이 없습니다.",
        resumeTo: (p)=> `지난번에는 “${p}” 까지 진행했어요.`,
        phase: { sunrise:"새벽", day:"낮", night:"밤" },
        langLabel: "언어",
      },
    };

    const LS = {
      lang: "who_vq_lang",
      lastPage: "who_vq_last_page",
      phase: "who_vq_phase" // 任意：保存されていれば優先
    };

    /***** 背景フェーズ推定 *****/
    function guessPhase(){
      const saved = localStorage.getItem(LS.phase);
      if (saved && BG_MAP[saved]) return saved;

      const h = new Date().getHours();
      // 朝日 4-9 / 昼 10-17 / 夜 他
      if (h >= 4 && h <= 9) return "sunrise";
      if (h >= 10 && h <= 17) return "day";
      return "night";
    }

    function setBackground(phase){
      const url = BG_MAP[phase] || BG_MAP.night;
      const el = document.getElementById("bg");
      el.style.backgroundImage = `url("${url}")`;
      requestAnimationFrame(()=> el.classList.add("show"));
    }

    /***** 言語適用 *****/
    function applyLang(lang){
      const dict = I18N[lang] || I18N.ja;
      document.documentElement.lang = dict.htmlLang;
      document.getElementById("title").textContent = dict.title;
      document.getElementById("subtitle").textContent = dict.subtitle;
      document.getElementById("btnStart").textContent = dict.start;
      document.getElementById("btnResume").textContent = dict.resume;
      document.getElementById("btnAbout").textContent = dict.about;
      document.getElementById("langLabel").textContent = dict.langLabel;

      const phase = currentPhase;
      document.getElementById("phaseBadge").textContent = dict.phase[phase] || "";

      const last = localStorage.getItem(LS.lastPage);
      const resumeBtn = document.getElementById("btnResume");
      const note = document.getElementById("resumeNote");
      if (last){
        resumeBtn.disabled = false;
        note.textContent = dict.resumeTo(last);
      } else {
        resumeBtn.disabled = true;
        note.textContent = dict.noResume;
      }
    }

    /***** ナビゲーション *****/
    function go(href){
      // ここでは index 自身は保存しない。遷移先で保存する。
      location.href = href;
    }

    /***** 初期化 *****/
    const currentPhase = guessPhase();
    setBackground(currentPhase);

    const langSel = document.getElementById("lang");
    // 既定は LS.lang またはブラウザ言語（ja/en/zh/ko）
    const browser = (navigator.language || "ja").slice(0,2);
    const initialLang = localStorage.getItem(LS.lang) || (["ja","en","zh","ko"].includes(browser) ? browser : "ja");
    langSel.value = initialLang;
    applyLang(initialLang);

    langSel.addEventListener("change", ()=>{
      const v = langSel.value;
      localStorage.setItem(LS.lang, v);
      applyLang(v);
    });

    // ボタン
    document.getElementById("btnStart").addEventListener("click", ()=> go("char.html"));
    document.getElementById("btnAbout").addEventListener("click", ()=> {
      localStorage.setItem(LS.lastPage, "about.html");
      go("about.html");
    });
    document.getElementById("btnResume").addEventListener("click", ()=>{
      const last = localStorage.getItem(LS.lastPage);
      if (last) go(last);
    });

    // Enter キーでスタート
    window.addEventListener("keydown", (e)=>{
      if (e.key === "Enter") document.getElementById("btnStart").click();
    });
  </script>
</body>
</html>

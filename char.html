<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>WHO VQ — キャラクター選択</title>

  <!-- 背景を先読み（朝日・昼・夜） -->
  <link rel="preload" as="image" href="public/bg/sunrise.jpg" />
  <link rel="preload" as="image" href="public/bg/beach_day.jpg" />
  <link rel="preload" as="image" href="public/bg/night_beach.jpg" />

  <!-- タネ画像を先読み（必要に応じて追加OK） -->
  <link rel="preload" as="image" href="public/assets/stage1/pink_closed.png" />
  <link rel="preload" as="image" href="public/assets/stage1/blue_closed.png" />
  <link rel="preload" as="image" href="public/assets/stage1/green_closed.png" />
  <link rel="preload" as="image" href="public/assets/stage1/purple_closed.png" />

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family: "Hiragino Sans","Meiryo",system-ui,sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(180deg,#08121c 0%,#0b2236 40%,#06111a 100%);
      color:#fff; min-height:100vh; overflow-x:hidden
    }
    header{
      position:sticky; top:0; z-index:10;
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px;
      background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0));
      backdrop-filter: blur(8px);
    }
    .logo{font-weight:700; letter-spacing:.06em}
    .meta{opacity:.9; font-size:.95rem}
    .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 32px}
    h1{font-size:1.6rem; font-weight:600; margin:6px 0 14px}
    p.lead{opacity:.95; margin-bottom:18px}

    section{margin-top:26px}
    .grid{display:grid; gap:16px; grid-template-columns: repeat(4, minmax(0,1fr));}
    @media (max-width:900px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }

    .card{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.18);
      border-radius:16px; padding:14px; text-align:center;
      transition:.25s; position:relative; overflow:hidden
    }
    .card:hover{transform: translateY(-3px); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .card.selected{outline:2px solid #64b5ff; box-shadow:0 0 0 3px rgba(100,181,255,.35) inset}

    .tag{
      display:inline-block; padding:4px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.08); font-size:12px
    }
    .imgbox{height:160px; display:flex; align-items:center; justify-content:center; margin-bottom:8px}
    .imgbox img{max-width:80%; max-height:160px; image-rendering:auto}
    .name{font-weight:700; margin:6px 0 2px}
    .sub{opacity:.8; font-size:.9rem}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 16px; border-radius:999px; font-weight:600; letter-spacing:.02em;
      color:#fff; background:#2d6cdf; transition:.2s
    }
    .btn:hover{filter:brightness(1.08)}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.3)}
    .btn.secondary{background:#0f7a5f}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .notice{
      margin-top:10px; padding:10px 12px; border-radius:12px;
      background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18);
      font-size:.95rem
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">WHO VQ</div>
    <div class="meta">総取得：<span id="total">0</span> 個</div>
  </header>

  <div class="wrap">
    <h1>キャラクターを選ぶ</h1>
   

    <!-- タネキャラだけ -->
    <section>
      <div class="row" style="justify-content:space-between; margin-bottom:10px;">
        <h2 style="font-size:1.2rem;font-weight:700">friend</h2>
        <span class="tag">必須：ひとつ選ぶ</span>
      </div>
      <div class="grid" id="seedGrid"></div>
      <div class="notice" id="seedNote">選択結果：<span id="seedSel">未選択</span></div>
    </section>

    <section style="margin-top:22px; display:flex; gap:10px; justify-content:flex-end">
      <button class="btn ghost" onclick="location.href='index.html'">戻る</button>
      <button class="btn secondary" id="saveBtn">決定してはじめる</button>
    </section>
  </div>

  <script>
    // 画像パス（public/assets/stage1/ に統一）
    const ASSET = (name)=>`public/assets/stage1/${name}`;

    // friend（必要なら *_open.png に揃えてもOK）
    const SEEDS = [
      {key:'pink',  name:'Mi（ピンク）',  src:ASSET('pink_open.png')},
      {key:'blue',  name:'Be（ブルー）',  src:ASSET('blue_open.png')},
      {key:'green', name:'Co（グリーン）',src:ASSET('green_open.png')},
      {key:'purple',name:'Su（パープル）',src:ASSET('purple_open.png')}
    ];

    // 状態
    const total = parseInt(localStorage.getItem('who_shells_total') || '0', 10);
    const savedChar = JSON.parse(localStorage.getItem('who_character') || 'null');
    let seedChoice = savedChar?.type === 'tane' ? savedChar.color : null;

    // DOM取得
    const totalEl = document.getElementById('total');
    const seedGrid = document.getElementById('seedGrid');
    const seedSel  = document.getElementById('seedSel');
    const saveBtn  = document.getElementById('saveBtn');

    totalEl.textContent = total.toString();

    // タネカード描画
    SEEDS.forEach(item=>{
      const c = document.createElement('div'); c.className = 'card';
      c.innerHTML = `
        <div class="imgbox"><img src="${item.src}" alt="${item.name}" /></div>
        <div class="name">${item.name}</div>
        <div class="sub">はじめの相棒</div>`;
      if(seedChoice === item.key) c.classList.add('selected');
      c.addEventListener('click', ()=>{
        seedChoice = item.key;
        [...seedGrid.children].forEach(el=>el.classList.remove('selected'));
        c.classList.add('selected');
        seedSel.textContent = item.name;
      });
      seedGrid.appendChild(c);
    });
    if(seedChoice){
      const found = SEEDS.find(s=>s.key===seedChoice);
      if(found) seedSel.textContent = found.name;
    }

    // 保存 & 遷移（マカロンは使わない）
    saveBtn.addEventListener('click', ()=>{
      if(!seedChoice){
        alert('キャラをひとつ選んでください。');
        return;
      }
      localStorage.setItem('who_character', JSON.stringify({type:'tane', color:seedChoice}));
      // 互換：もし過去に保存されていたマカロン色があっても無視（削除したい場合は以下ON）
      // localStorage.removeItem('who_macaron_color');

      localStorage.setItem('who_lastPage', 'asari.html');
      location.href = 'asari.html';
    });

    // ページ記録
    localStorage.setItem('who_lastPage','char.html');
  </script>
</body>
</html>
